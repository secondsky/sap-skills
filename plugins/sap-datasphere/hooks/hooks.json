{
  "description": "SAP Datasphere validation hooks for SQL/view development best practices",
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "First, check if the file being written/edited is an SAP Datasphere file. It is a Datasphere file ONLY if the file has a .sql extension, or contains Datasphere/HANA SQL signatures such as: CREATE VIEW, CREATE TABLE, CREATE PROCEDURE, SELECT, JOIN, UNION, DEFAULT SCHEMA, COLUMN TABLE, ROW TABLE — AND relates to Datasphere concepts like: Fact, Dimension, Relational Dataset, semantic usage, Data Access Controls, analytic model, space context.\n\nIf the file is NOT a Datasphere SQL/data model file, output nothing.\n\nIf it IS a Datasphere file, validate the following best practices BEFORE the write:\n\n1. **No hardcoded schema names** - Schema names should not be embedded in SQL; use DEFAULT SCHEMA or space context\n2. **Proper semantic annotations** - Check that views intended for analytics have appropriate semantic usage comments (Fact, Dimension, Relational Dataset)\n3. **Association naming conventions** - Foreign key columns should follow pattern: <ENTITY>_ID for clear association mapping\n4. **Data access control consideration** - If sensitive data (employee, financial, customer), note that Data Access Controls may be needed\n5. **Column naming** - Use UPPER_SNAKE_CASE for technical names, provide readable business names in aliases\n6. **Null handling** - Use COALESCE or NULLIF for measure calculations to prevent null propagation\n7. **Date handling** - Use explicit CAST for date conversions, avoid implicit type conversions\n\nIf any issues found, provide brief recommendations. If code looks good, silently approve.",
            "timeout": 30
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "First, check if the file just written/edited is an SAP Datasphere file. It is a Datasphere file ONLY if the file has a .sql extension, or contains Datasphere/HANA SQL signatures such as: CREATE VIEW, CREATE TABLE, CREATE PROCEDURE, SELECT, JOIN, UNION, DEFAULT SCHEMA, COLUMN TABLE, ROW TABLE — AND relates to Datasphere concepts like: Fact, Dimension, Relational Dataset, semantic usage, Data Access Controls, analytic model, space context.\n\nIf the file is NOT a Datasphere SQL/data model file, output nothing.\n\nIf it IS a Datasphere file, provide helpful suggestions for the user to consider:\n\n1. **View Persistence** - For views with complex joins or large result sets, consider enabling view persistence with snapshot or real-time refresh\n2. **Partition Strategy** - For fact tables with >1M rows, suggest time-based or range partitioning\n3. **Statistics** - Remind to enable automatic statistics collection for tables used in complex queries\n4. **Index Candidates** - If WHERE clauses filter on specific columns frequently, note potential index candidates\n5. **Lineage Documentation** - Suggest documenting source-to-target lineage in view comments\n6. **Testing** - Recommend using Data Preview to validate transformations before deployment\n\nKeep suggestions brief and actionable. Only mention applicable suggestions.",
            "timeout": 15
          }
        ]
      }
    ]
  }
}
